"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var PIXI=require("pixi.js"),ReactFiberReconciler=_interopDefault(require("react-reconciler")),React=_interopDefault(require("react"));function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function invariant(e,t,n,r,i,o,a,c){if(!e){var p;if(void 0===t)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,i,o,a,c],u=0;(p=new Error(t.replace(/%s/g,function(){return s[u++]}))).name="Invariant Violation"}throw p.framesToPop=1,p}}var invariant_1=invariant,INJECTED_TYPES={};function injectType(e,t){return INJECTED_TYPES[e]=t,e}function createInjectedTypeInstance(e,t,n,r){var i;if(e in INJECTED_TYPES){var o,a=INJECTED_TYPES[e];"function"==typeof a?o=a:"function"==typeof a.customDisplayObject&&(o=a.customDisplayObject),invariant_1(o,"Invalid Component injected to ReactPixiFiber: `%s`.",e),i=o(t),"function"==typeof a.customApplyProps&&(i._customApplyProps=a.customApplyProps.bind({applyDisplayObjectProps:r.bind(null,i)})),"function"==typeof a.customDidAttach&&(i._customDidAttach=a.customDidAttach),"function"==typeof a.customWillDetach&&(i._customWillDetach=a.customWillDetach)}return i}function isInjectedType(e){return void 0!==INJECTED_TYPES[e]}function CustomPIXIComponent(e,t){return invariant_1("string"==typeof t,"Invalid argument `type` of type `%s` supplied to `CustomPIXIComponent`, expected `string`.",_typeof(t)),injectType(t,e)}var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}function makeEmptyFunction(e){return function(){return e}}var emptyFunction=function(){};emptyFunction.thatReturns=makeEmptyFunction,emptyFunction.thatReturnsFalse=makeEmptyFunction(!1),emptyFunction.thatReturnsTrue=makeEmptyFunction(!0),emptyFunction.thatReturnsNull=makeEmptyFunction(null),emptyFunction.thatReturnsThis=function(){return this},emptyFunction.thatReturnsArgument=function(e){return e};var emptyFunction_1=emptyFunction,ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret,factoryWithThrowingShims=function(){function e(e,t,n,r,i,o){o!==ReactPropTypesSecret_1&&invariant_1(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=emptyFunction_1,n.PropTypes=n,n},propTypes=createCommonjsModule(function(e){e.exports=factoryWithThrowingShims()}),name="react-pixi-fiber",version="0.4.3",description="React Fiber renderer for PixiJS",main="index.js",author="Michal Ochman",license="MIT",repository="github:nervestaple/react-pixi-fiber",typings="./index.d.ts",files=["LICENSE","README.md","index.d.ts","index.js","react-pixi-alias.js","cjs/","src/"],dependencies={fbjs:"^0.8.0","performance-now":"^2.1.0","react-reconciler":"^0.8.0-alpha.3"},peerDependencies={"pixi.js":"^4.4.0",react:"^16.3.0-rc.0","react-dom":"^16.3.0-rc.0"},devDependencies={"@babel/core":"^7.0.0-beta.42","@babel/preset-env":"^7.0.0-beta.42","@babel/preset-react":"^7.0.0-beta.42","@babel/preset-stage-0":"^7.0.0-beta.42","@types/pixi.js":"^4.4.0","@types/react":"^16.0.0","babel-core":"^7.0.0-bridge.0","babel-eslint":"^8.2.1","babel-jest":"^22.4.1","babel-plugin-rewire":"^1.1.0","babel-preset-env":"^1.6.1","canvas-prebuilt":"^1.6.5-prerelease.1",codecov:"^3.0.0",eslint:"^4.17.0","eslint-config-prettier":"^2.9.0","eslint-plugin-babel":"^4.1.0","eslint-plugin-import":"^2.8.0","eslint-plugin-prettier":"^2.6.0","eslint-plugin-promise":"^3.6.0","eslint-plugin-react":"^7.6.1",jest:"^22.4.2","pixi.js":"^4.4.0",prettier:"^1.9.2",react:"16.3.0-rc.0","react-dom":"16.3.0-rc.0","react-test-renderer":"^16.0.0",rollup:"^0.56.3","rollup-plugin-babel":"^4.0.0-beta.3","rollup-plugin-commonjs":"^8.3.0","rollup-plugin-json":"^2.3.0","rollup-plugin-node-globals":"^1.1.0","rollup-plugin-node-resolve":"^3.0.3","rollup-plugin-replace":"^2.0.0","rollup-plugin-uglify":"^3.0.0"},scripts={build:"npm run build:prod && npm run build:dev","build:dev":"npm run build:index:dev && npm run build:alias:dev","build:prod":"npm run build:index:prod && npm run build:alias:prod","build:alias:dev":"NODE_ENV=development rollup -c config/rollup.alias.js","build:alias:prod":"rollup -c config/rollup.alias.js","build:index:dev":"NODE_ENV=development rollup -c config/rollup.index.js","build:index:prod":"rollup -c config/rollup.index.js",eslint:"eslint src","eslint-check":"eslint --print-config .eslintrc.json | eslint-config-prettier-check",prepublish:"npm run build",test:"jest"},jest={coverageDirectory:"coverage",coverageReporters:["lcov","text-summary"],collectCoverageFrom:["src/**/*.js"],globals:{false:!0},setupFiles:["./test/jest.setupPixi.js"],transform:{"^.+\\.js$":"babel-jest"}},pkg={name:name,version:version,description:description,main:main,author:author,license:license,repository:repository,typings:typings,files:files,dependencies:dependencies,peerDependencies:peerDependencies,devDependencies:devDependencies,scripts:scripts,jest:jest},CHILDREN="children",RESERVED_PROPS=_defineProperty({},CHILDREN,!0),DEFAULT_PROPS={alpha:1,buttonMode:!1,cacheAsBitmap:!1,cursor:"auto",filterArea:null,filters:null,hitArea:null,interactive:!1,mask:null,pivot:0,position:0,renderable:!0,rotation:0,scale:1,skew:0,transform:null,visible:!0,x:0,y:0},emptyObject={},emptyObject_1=emptyObject,global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version$1="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance$1=global$1.performance||{},performanceNow=performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance$1),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version$1,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},performanceNow$1=createCommonjsModule(function(e){(function(){var t,n,r,i,o,a;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:void 0!==process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-o)/1e6},n=process.hrtime,i=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),a=1e9*process.uptime(),o=i-a):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(commonjsGlobal)}),TYPES={BITMAP_TEXT:"bitmap-text",CONTAINER:"container",GRAPHICS:"graphics",PARTICLE_CONTAINER:"particle-container",SPRITE:"sprite",TEXT:"text",TILING_SPRITE:"tiling-sprite"},not=function(e){return function(){return!e.apply(void 0,arguments)}},including=function(e){return function(t){return-1!==e.indexOf(t)}};function filterByKey(e,t){var n={};return Object.keys(e).filter(t).forEach(function(t){n[t]=e[t]}),n}var includingReservedProps=including(Object.keys(RESERVED_PROPS));function parsePoint(e){var t=[];return void 0===e?t:("string"==typeof e?t=e.split(","):"number"==typeof e?t=[e]:Array.isArray(e)?t=e.slice():void 0!==e.x&&void 0!==e.y&&(t=[e.x,e.y]),t.map(Number))}function isPointType(e){return e instanceof PIXI.Point||e instanceof PIXI.ObservablePoint}function setPixiValue(e,t,n){if(isPointType(e[t])&&isPointType(n))e[t].copy(n);else if(isPointType(e[t])){var r=parsePoint(n);invariant_1(void 0!==r&&r.length>0&&r.length<3,"The property `%s` is a PIXI.Point or PIXI.ObservablePoint and must be set to a comma-separated string of either 1 or 2 coordinates, a 1 or 2 element array containing coordinates, or a PIXI Point/ObservablePoint. If only one coordinate is given then X and Y will be set to the provided value. Received: `%s` of type `%s`.",t,JSON.stringify(n),_typeof(n)),e[t].set(r.shift(),r.shift())}else e[t]=n}function defaultApplyProps(e,t,n){Object.keys(n).filter(not(includingReservedProps)).forEach(function(t){var r=n[t];void 0!==r?setPixiValue(e,t,r):void 0!==e[t]&&void 0!==DEFAULT_PROPS[t]?(console.warn("setting default value: ".concat(t," was ").concat(e[t]," is ").concat(r," for"),e),setPixiValue(e,t,DEFAULT_PROPS[t])):console.warn("ignoring prop: ".concat(t," was ").concat(e[t]," is ").concat(r," for"),e)})}function applyProps(e,t,n){"function"==typeof e._customApplyProps?e._customApplyProps(e,t,n):defaultApplyProps(e,t,n)}function diffProps(e,t,n,r,i){var o,a=null,c=n,p=r;for(o in c)!p.hasOwnProperty(o)&&c.hasOwnProperty(o)&&null!=c[o]&&(o===CHILDREN||(a=a||[]).push(o,null));for(o in p){var s=p[o],u=null!=c?c[o]:void 0;!p.hasOwnProperty(o)||s===u||null==s&&null==u||(o===CHILDREN||(a=a||[]).push(o,s))}return a}function appendChild(e,t){e.removeChild(t),e.addChild(t),"function"==typeof t._customDidAttach&&t._customDidAttach(t)}function removeChild(e,t){"function"==typeof t._customWillDetach&&t._customWillDetach(t),e.removeChild(t),t.destroy()}function insertBefore(e,t,n){invariant_1(t!==n,"ReactPixiFiber cannot insert node before itself");var r=-1!==e.children.indexOf(t),i=e.getChildIndex(n);r?e.setChildIndex(t,i):e.addChildAt(t,i)}function commitUpdate(e,t,n,r,i,o){if(isInjectedType(n))applyProps(e,r,i);else{var a=including(t.filter(function(e,t){return t%2==0}));applyProps(e,filterByKey(r,a),filterByKey(i,a))}}function createInstance(e,t,n){var r;switch(e){case TYPES.BITMAP_TEXT:r=new PIXI.extras.BitmapText(t.text,t.style);break;case TYPES.CONTAINER:r=new PIXI.Container;break;case TYPES.GRAPHICS:r=new PIXI.Graphics;break;case TYPES.PARTICLE_CONTAINER:r=new PIXI.particles.ParticleContainer(t.maxSize,t.properties,t.batchSize,t.autoResize);break;case TYPES.SPRITE:r=new PIXI.Sprite(t.texture);break;case TYPES.TEXT:r=new PIXI.Text(t.text,t.style,t.canvas);break;case TYPES.TILING_SPRITE:r=new PIXI.extras.TilingSprite(t.texture,t.width,t.height);break;default:r=createInjectedTypeInstance(e,t,n,defaultApplyProps)}return invariant_1(r,"ReactPixiFiber does not support the type: `%s`.",e),applyProps(r,{},t),r}function createTextInstance(e,t,n){invariant_1(!1,"ReactPixiFiber does not support text instances. Use Text component instead.")}function finalizeInitialChildren(e,t,n,r){return!1}function getChildHostContext(e,t){return emptyObject_1}function getRootHostContext(e){return emptyObject_1}function getPublicInstance(e){return e}function prepareForCommit(){}function prepareUpdate(e,t,n,r,i,o){return diffProps(e,t,n,r,i)}function resetAfterCommit(){}function resetTextContent(e){}function shouldDeprioritizeSubtree(e,t){var n=void 0===t.alpha||t.alpha>0,r=void 0===t.renderable||!0===t.renderable,i=void 0===t.visible||!0===t.visible;return!(n&&r&&i)}function shouldSetTextContent(e,t){return!1}function commitTextUpdate(e,t,n){}function commitMount(e,t,n){}var ReactPixiFiber=ReactFiberReconciler({appendInitialChild:appendChild,createInstance:createInstance,createTextInstance:createTextInstance,finalizeInitialChildren:finalizeInitialChildren,getChildHostContext:getChildHostContext,getRootHostContext:getRootHostContext,getPublicInstance:getPublicInstance,now:performanceNow$1,prepareForCommit:prepareForCommit,prepareUpdate:prepareUpdate,resetAfterCommit:resetAfterCommit,resetTextContent:resetTextContent,shouldDeprioritizeSubtree:shouldDeprioritizeSubtree,shouldSetTextContent:shouldSetTextContent,useSyncScheduling:!0,mutation:{appendChild:appendChild,appendChildToContainer:appendChild,commitMount:commitMount,commitTextUpdate:commitTextUpdate,commitUpdate:commitUpdate,insertBefore:insertBefore,insertInContainerBefore:insertBefore,removeChild:removeChild,removeChildFromContainer:removeChild}});function validateCanvas(e,t,n){var r=e[t];if(void 0!==r&&!(r instanceof Element&&"function"==typeof r.getContext)){var i=_typeof(r);return new Error("Invalid prop '".concat(t,"' of type '").concat(i,"' supplied to '").concat(n,"', expected '<canvas> Element'."))}}var propTypes$1={options:propTypes.shape({antialias:propTypes.bool,autoStart:propTypes.bool,backgroundColor:propTypes.number,clearBeforeRender:propTypes.bool,forceCanvas:propTypes.bool,forceFXAA:propTypes.bool,height:propTypes.number,legacy:propTypes.bool,powerPreference:propTypes.string,preserveDrawingBuffer:propTypes.bool,resolution:propTypes.number,roundPixels:propTypes.bool,sharedLoader:propTypes.bool,sharedTicker:propTypes.bool,transparent:propTypes.bool,view:validateCanvas,width:propTypes.number}),children:propTypes.node,height:propTypes.number,width:propTypes.number},childContextTypes={app:propTypes.object},includingDisplayObjectProps=including(Object.keys(DEFAULT_PROPS)),includingStageProps=including(Object.keys(propTypes$1)),includingCanvasProps=function(e){return!includingDisplayObjectProps(e)&&!includingStageProps(e)},getCanvasProps=function(e){return filterByKey(e,includingCanvasProps)},getDisplayObjectProps=function(e){return filterByKey(e,includingDisplayObjectProps)},Stage=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"getChildContext",value:function(){return{app:this._app}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.children,n=e.height,r=e.options,i=e.width;this._app=new PIXI.Application(i,n,_objectSpread({view:this._canvas},r));var o=getDisplayObjectProps(this.props);applyProps(this._app.stage,{},o),this._mountNode=ReactPixiFiber.createContainer(this._app.stage),ReactPixiFiber.updateContainer(t,this._mountNode,this),ReactPixiFiber.injectIntoDevTools({findFiberByHostInstance:ReactPixiFiber.findFiberByHostInstance,bundleType:0,version:pkg.version,rendererPackageName:pkg.name})}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=n.children,i=n.height,o=n.width,a=getDisplayObjectProps(this.props);applyProps(this._app.stage,{},a),i===e.height&&o===e.width||this._app.renderer.resize(o,i),ReactPixiFiber.updateContainer(r,this._mountNode,this)}},{key:"componentWillUnmount",value:function(){ReactPixiFiber.updateContainer(null,this._mountNode,this)}},{key:"render",value:function(){var e=this,t=this.props.options,n=getCanvasProps(this.props);return void 0!==t&&t.view?null:React.createElement("canvas",_extends({ref:function(t){return e._canvas=t}},n))}}]),t}();Stage.propTypes=propTypes$1,Stage.childContextTypes=childContextTypes;var roots=new Map;function render(e,t,n){var r=roots.get(t);return r||(r=ReactPixiFiber.createContainer(t),roots.set(t,r)),ReactPixiFiber.updateContainer(e,r,void 0,n),ReactPixiFiber.injectIntoDevTools({findFiberByHostInstance:ReactPixiFiber.findFiberByHostInstance,bundleType:0,version:pkg.version,rendererPackageName:pkg.name}),ReactPixiFiber.getPublicRootInstance(r)}var BitmapText=TYPES.BITMAP_TEXT,Container=TYPES.CONTAINER,Graphics=TYPES.GRAPHICS,ParticleContainer=TYPES.PARTICLE_CONTAINER,Sprite=TYPES.SPRITE,Text=TYPES.TEXT,TilingSprite=TYPES.TILING_SPRITE;exports.CustomPIXIComponent=CustomPIXIComponent,exports.Stage=Stage,exports.render=render,exports.BitmapText=BitmapText,exports.Container=Container,exports.Graphics=Graphics,exports.ParticleContainer=ParticleContainer,exports.Sprite=Sprite,exports.Text=Text,exports.TilingSprite=TilingSprite;
